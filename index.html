<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä½“é‡ç®¡ç†åŠ©æ‰‹</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 480px;
            margin: 0 auto;
        }
        
        .card {
            background: white;
            border-radius: 20px;
            padding: 24px;
            margin-bottom: 16px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
        }
        
        .header {
            text-align: center;
            color: white;
            margin-bottom: 20px;
        }
        
        .header h1 {
            font-size: 28px;
            margin-bottom: 8px;
        }
        
        .header p {
            opacity: 0.9;
            font-size: 14px;
        }
        
        .status-card {
            background: linear-gradient(135deg, #4CAF50 0%, #81C784 100%);
            color: white;
            text-align: center;
        }
        
        .bmi-value {
            font-size: 72px;
            font-weight: bold;
            line-height: 1;
        }
        
        .bmi-label {
            font-size: 18px;
            opacity: 0.9;
        }
        
        .bmi-category {
            display: inline-block;
            background: rgba(255,255,255,0.3);
            padding: 6px 16px;
            border-radius: 20px;
            margin-top: 12px;
            font-size: 14px;
        }
        
        .input-group {
            margin: 20px 0;
        }
        
        .input-group label {
            display: block;
            margin-bottom: 8px;
            color: #666;
            font-size: 14px;
        }
        
        .input-group input {
            width: 100%;
            padding: 16px;
            border: 2px solid #eee;
            border-radius: 12px;
            font-size: 24px;
            text-align: center;
            transition: border-color 0.3s;
        }
        
        .input-group input:focus {
            outline: none;
            border-color: #4CAF50;
        }
        
        .btn {
            width: 100%;
            padding: 16px;
            border: none;
            border-radius: 12px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, opacity 0.2s;
        }
        
        .btn:active {
            transform: scale(0.98);
        }
        
        .btn-primary {
            background: #4CAF50;
            color: white;
        }
        
        .btn-secondary {
            background: #f5f5f5;
            color: #333;
            margin-top: 12px;
        }
        
        .btn-sync {
            background: #2196F3;
            color: white;
            margin-top: 12px;
        }
        
        .progress-section {
            margin-top: 20px;
        }
        
        .progress-bar {
            height: 12px;
            background: #e0e0e0;
            border-radius: 6px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4CAF50, #81C784);
            border-radius: 6px;
            transition: width 0.5s ease;
        }
        
        .progress-labels {
            display: flex;
            justify-content: space-between;
            margin-top: 8px;
            font-size: 13px;
            color: #666;
        }
        
        .plan-section h3 {
            margin-bottom: 16px;
            color: #333;
        }
        
        .plan-item {
            display: flex;
            align-items: flex-start;
            margin-bottom: 12px;
        }
        
        .plan-icon {
            width: 24px;
            height: 24px;
            background: #e8f5e9;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 12px;
            flex-shrink: 0;
        }
        
        .plan-text {
            font-size: 14px;
            color: #555;
            line-height: 1.5;
        }
        
        .records-list {
            max-height: 200px;
            overflow-y: auto;
        }
        
        .record-item {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .record-item:last-child {
            border-bottom: none;
        }
        
        .record-date {
            color: #666;
            font-size: 14px;
        }
        
        .record-weight {
            font-weight: 600;
            color: #333;
        }
        
        .toast {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: #333;
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 14px;
            opacity: 0;
            transition: opacity 0.3s;
            z-index: 1000;
        }
        
        .toast.show {
            opacity: 1;
        }
        
        .toast.success { background: #4CAF50; }
        .toast.error { background: #F44336; }
        .toast.syncing { background: #2196F3; }
        
        .tab-nav {
            display: flex;
            background: white;
            border-radius: 12px;
            padding: 4px;
            margin-bottom: 16px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
        }
        
        .tab-btn {
            flex: 1;
            padding: 12px;
            border: none;
            background: none;
            border-radius: 8px;
            font-size: 14px;
            color: #666;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .tab-btn.active {
            background: #4CAF50;
            color: white;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .settings-group {
            margin-bottom: 20px;
        }
        
        .settings-group label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-size: 14px;
        }
        
        .settings-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid #eee;
            border-radius: 8px;
            font-size: 16px;
        }
        
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #999;
        }
        
        .sync-status {
            font-size: 12px;
            color: #999;
            text-align: center;
            margin-top: 8px;
        }
        
        .sync-status.synced {
            color: #4CAF50;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>âš–ï¸ ä½“é‡ç®¡ç†åŠ©æ‰‹</h1>
            <p>è®°å½•ä½“é‡ Â· è¿½è¸ªè¿›åº¦ Â· äº‘ç«¯åŒæ­¥</p>
        </div>
        
        <div class="tab-nav">
            <button class="tab-btn active" onclick="switchTab('record')">è®°å½•</button>
            <button class="tab-btn" onclick="switchTab('history')">å†å²</button>
            <button class="tab-btn" onclick="switchTab('plan')">æ–¹æ¡ˆ</button>
            <button class="tab-btn" onclick="switchTab('settings')">è®¾ç½®</button>
        </div>
        
        <!-- è®°å½•é¡µé¢ -->
        <div id="tab-record" class="tab-content active">
            <div class="card status-card">
                <div class="bmi-value" id="bmi-display">--</div>
                <div class="bmi-label">BMI èº«ä½“è´¨é‡æŒ‡æ•°</div>
                <div class="bmi-category" id="bmi-category">è¯·è®°å½•ä½“é‡</div>
            </div>
            
            <div class="card">
                <div class="input-group">
                    <label>ä»Šæ—¥ä½“é‡ (kg)</label>
                    <input type="number" id="weight-input" placeholder="0.0" step="0.1">
                </div>
                <button class="btn btn-primary" onclick="saveWeight()">è®°å½•ä½“é‡</button>
                <button class="btn btn-sync" onclick="syncData()" id="sync-btn">â˜ï¸ åŒæ­¥æ•°æ®</button>
                <div class="sync-status" id="sync-status">ç‚¹å‡»åŒæ­¥æŒ‰é’®å°†æ•°æ®ä¿å­˜åˆ°äº‘ç«¯</div>
                
                <div class="progress-section">
                    <div class="progress-bar">
                        <div class="progress-fill" id="progress-fill" style="width: 0%"></div>
                    </div>
                    <div class="progress-labels">
                        <span>å½“å‰: <span id="current-weight">--</span>kg</span>
                        <span>ç›®æ ‡: <span id="target-weight">65</span>kg</span>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- å†å²é¡µé¢ -->
        <div id="tab-history" class="tab-content">
            <div class="card">
                <h3 style="margin-bottom: 16px;">ğŸ“Š æœ€è¿‘è®°å½•</h3>
                <div class="records-list" id="records-list">
                    <div class="empty-state">æš‚æ— è®°å½•</div>
                </div>
            </div>
            
            <div class="card">
                <h3 style="margin-bottom: 16px;">ğŸ“ˆ æ•°æ®ç»Ÿè®¡</h3>
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px;">
                    <div style="background: #f9f9f9; padding: 16px; border-radius: 8px; text-align: center;">
                        <div style="font-size: 24px; font-weight: bold; color: #4CAF50;" id="stat-count">0</div>
                        <div style="font-size: 12px; color: #999;">è®°å½•å¤©æ•°</div>
                    </div>
                    <div style="background: #f9f9f9; padding: 16px; border-radius: 8px; text-align: center;">
                        <div style="font-size: 24px; font-weight: bold; color: #4CAF50;" id="stat-avg">--</div>
                        <div style="font-size: 12px; color: #999;">å¹³å‡ä½“é‡</div>
                    </div>
                    <div style="background: #f9f9f9; padding: 16px; border-radius: 8px; text-align: center;">
                        <div style="font-size: 24px; font-weight: bold; color: #4CAF50;" id="stat-min">--</div>
                        <div style="font-size: 12px; color: #999;">æœ€ä½ä½“é‡</div>
                    </div>
                    <div style="background: #f9f9f9; padding: 16px; border-radius: 8px; text-align: center;">
                        <div style="font-size: 24px; font-weight: bold; color: #4CAF50;" id="stat-max">--</div>
                        <div style="font-size: 12px; color: #999;">æœ€é«˜ä½“é‡</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- æ–¹æ¡ˆé¡µé¢ -->
        <div id="tab-plan" class="tab-content">
            <div class="card">
                <h3 style="margin-bottom: 16px;">ğŸ¯ å‡è‚¥æ–¹æ¡ˆ</h3>
                <div id="plan-content">
                    <div class="plan-item">
                        <div class="plan-icon">ğŸ“‹</div>
                        <div class="plan-text">è¯·å…ˆè®°å½•ä½“é‡è·å–ä¸ªæ€§åŒ–æ–¹æ¡ˆ</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- è®¾ç½®é¡µé¢ -->
        <div id="tab-settings" class="tab-content">
            <div class="card">
                <h3 style="margin-bottom: 16px;">âš™ï¸ ä¸ªäººè®¾ç½®</h3>
                <div class="settings-group">
                    <label>èº«é«˜ (cm)</label>
                    <input type="number" id="height-setting" value="170" onchange="saveSettings()">
                </div>
                <div class="settings-group">
                    <label>ç›®æ ‡ä½“é‡ (kg)</label>
                    <input type="number" id="target-setting" value="65" onchange="saveSettings()">
                </div>
                <button class="btn btn-secondary" onclick="clearData()">æ¸…é™¤æ‰€æœ‰æ•°æ®</button>
            </div>
        </div>
    </div>
    
    <div class="toast" id="toast"></div>
    
    <script>
        // Gist é…ç½® - ç”¨äºäº‘ç«¯åŒæ­¥
        const GIST_ID = '005efc35e5e07b99173f7addaa88a376';
        const GIST_FILENAME = 'weight-data.json';
        
        // é»˜è®¤é…ç½®
        const DEFAULT_DATA = {
            records: [],
            height: 170,
            targetWeight: 65
        };
        
        let cloudData = null;
        
        // åŠ è½½äº‘ç«¯æ•°æ®
        async function loadCloudData() {
            try {
                const response = await fetch(`https://api.github.com/gists/${GIST_ID}`);
                if (!response.ok) throw new Error('Failed to fetch');
                
                const gist = await response.json();
                const content = gist.files[GIST_FILENAME].content;
                cloudData = JSON.parse(content);
                return cloudData;
            } catch (e) {
                console.log('No cloud data, using local');
                return null;
            }
        }
        
        // ä¿å­˜åˆ°äº‘ç«¯
        async function saveCloudData(data) {
            const content = JSON.stringify(data, null, 2);
            
            // è·å–å½“å‰çš„ Gist ä»¥è·å– eTag
            const getResponse = await fetch(`https://api.github.com/gists/${GIST_ID}`, {
                headers: {
                    'Authorization': 'token.github_pat',
                    'Accept': 'application/vnd.github.v3+json'
                }
            });
            
            const gist = await getResponse();
            const etag = gist.etag;
            
            const response = await fetch(`https://api.github.com/gists/${GIST_ID}`, {
                method: 'PATCH',
                headers: {
                    'Authorization': 'token.github_pat',
                    'Accept': 'application/vnd.github.v3+json'
                },
                body: JSON.stringify({
                    files: {
                        [GIST_FILENAME]: {
                            content: content
                        }
                    }
                })
            });
            
            if (!response.ok) {
                throw new Error('Failed to save to cloud');
            }
            
            return true;
        }
        
        // åŒæ­¥æ•°æ®
        async function syncData() {
            const btn = document.getElementById('sync-btn');
            const status = document.getElementById('sync-status');
            
            btn.disabled = true;
            btn.textContent = 'â˜ï¸ åŒæ­¥ä¸­...';
            status.textContent = 'æ­£åœ¨åŒæ­¥...';
            status.classList.remove('synced');
            
            showToast('æ­£åœ¨åŒæ­¥åˆ°äº‘ç«¯...', 'syncing');
            
            try {
                // å…ˆåŠ è½½äº‘ç«¯æ•°æ®
                const cloud = await loadCloudData();
                const local = loadData();
                
                // åˆå¹¶æ•°æ®ï¼šä»¥äº‘ç«¯æ•°æ®ä¸ºä¸»ï¼Œä½†ä¿ç•™æœ¬åœ°æ›´æ–°çš„è®°å½•
                let mergedData = cloud || local;
                
                if (cloud && local.records.length > 0) {
                    // åˆå¹¶è®°å½•ï¼Œä¿ç•™æœ€æ–°çš„
                    const allRecords = [...cloud.records, ...local.records];
                    const uniqueRecords = [];
                    const seen = new Set();
                    
                    for (const r of allRecords) {
                        if (!seen.has(r.date)) {
                            seen.add(r.date);
                            uniqueRecords.push(r);
                        }
                    }
                    
                    mergedData.records = uniqueRecords.sort((a, b) => new Date(a.date) - new Date(b.date));
                    mergedData.height = cloud.height || local.height;
                    mergedData.targetWeight = cloud.targetWeight || local.targetWeight;
                }
                
                // ä¿å­˜åˆå¹¶åçš„æ•°æ®åˆ°æœ¬åœ°å’Œäº‘ç«¯
                saveData(mergedData);
                await saveCloudData(mergedData);
                
                showToast('âœ… åŒæ­¥æˆåŠŸï¼æ•°æ®å·²ä¿å­˜åˆ°äº‘ç«¯', 'success');
                status.textContent = 'âœ… å·²åŒæ­¥åˆ°äº‘ç«¯ ' + new Date().toLocaleTimeString();
                status.classList.add('synced');
                
                updateDisplay();
            } catch (e) {
                console.error(e);
                showToast('âŒ åŒæ­¥å¤±è´¥: ' + e.message, 'error');
                status.textContent = 'âŒ åŒæ­¥å¤±è´¥ï¼Œç‚¹å‡»é‡è¯•';
            }
            
            btn.disabled = false;
            btn.textContent = 'â˜ï¸ åŒæ­¥æ•°æ®';
        }
        
        // åŠ è½½æœ¬åœ°æ•°æ®
        function loadData() {
            const saved = localStorage.getItem('weightData');
            return saved ? JSON.parse(saved) : DEFAULT_DATA;
        }
        
        // ä¿å­˜åˆ°æœ¬åœ°
        function saveData(data) {
            localStorage.setItem('weightData', JSON.stringify(data));
        }
        
        // è®¡ç®—BMI
        function calculateBMI(weight, height) {
            if (!weight || !height) return 0;
            return (weight / Math.pow(height / 100, 2)).toFixed(1);
        }
        
        // è·å–BMIåˆ†ç±»
        function getBMICategory(bmi) {
            if (bmi < 18.5) return { category: 'åç˜¦', color: '#FFA500', advice: 'éœ€è¦é€‚å½“å¢é‡' };
            if (bmi < 24) return { category: 'æ­£å¸¸', color: '#4CAF50', advice: 'ä¿æŒå¥åº·ç”Ÿæ´»æ–¹å¼' };
            if (bmi < 28) return { category: 'è¶…é‡', color: '#FF9800', advice: 'å»ºè®®é€‚å½“å‡é‡' };
            if (bmi < 30) return { category: 'è½»åº¦è‚¥èƒ–', color: '#FF5722', advice: 'éœ€è¦ç§¯æç®¡ç†' };
            return { category: 'è‚¥èƒ–', color: '#F44336', advice: 'å»ºè®®å’¨è¯¢åŒ»ç”Ÿ' };
        }
        
        // è·å–å‡è‚¥æ–¹æ¡ˆ
        function getPlan(bmi, height) {
            const targetMin = (18.5 * Math.pow(height / 100, 2)).toFixed(1);
            const targetMax = (24 * Math.pow(height / 100, 2)).toFixed(1);
            
            if (bmi >= 28) {
                return {
                    target: `${targetMin}-${targetMax}kg`,
                    duration: '6-12ä¸ªæœˆ',
                    diet: ['æ¯æ—¥1500-1800å¤§å¡', 'æˆ’é›¶é£Ÿã€é¥®æ–™ã€å®µå¤œ', '211é¥®é£Ÿæ³•', '19ç‚¹å‰åƒå®Œæ™šé¤'],
                    exercise: ['æ¯å¤©å¿«èµ°40åˆ†é’Ÿ', 'æ¯å‘¨3æ¬¡åŠ›é‡è®­ç»ƒ', 'é€æ­¥å¢åŠ è¿åŠ¨å¼ºåº¦'],
                    tips: ['å»ºè®®å’¨è¯¢è¥å…»å¸ˆ', 'å…³æ³¨è¡€å‹è¡€ç³–', 'ä¿æŒ7-8å°æ—¶ç¡çœ ']
                };
            } else {
                return {
                    target: `${targetMin}-${targetMax}kg`,
                    duration: '3-6ä¸ªæœˆ',
                    diet: ['æ¯æ—¥1800-2000å¤§å¡', 'å‡å°‘é«˜æ²¹é«˜ç›é£Ÿç‰©', 'å¤šåƒè”¬èœæ°´æœ', 'ç²—ç²®ä¸ºä¸»é£Ÿ'],
                    exercise: ['æ¯å‘¨å¿«èµ°5æ¬¡x30åˆ†é’Ÿ', 'æ¯å¤©20åˆ†é’Ÿæ ¸å¿ƒè®­ç»ƒ', 'æ¯å‘¨2æ¬¡æ¸¸æ³³æˆ–éª‘è¡Œ'],
                    tips: ['ä¸è¦æç«¯èŠ‚é£Ÿ', 'ä¿æŒè§„å¾‹ä½œæ¯', 'æ¯å‘¨ç§°é‡1æ¬¡']
                };
            }
        }
        
        // æ˜¾ç¤ºæç¤º
        function showToast(message, type = '') {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = 'toast show ' + type;
            setTimeout(() => toast.classList.remove('show'), 3000);
        }
        
        // åˆ‡æ¢æ ‡ç­¾é¡µ
        function switchTab(tab) {
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById('tab-' + tab).classList.add('active');
            
            if (tab === 'record') updateDisplay();
            if (tab === 'history') updateHistory();
            if (tab === 'plan') updatePlan();
        }
        
        // æ›´æ–°æ˜¾ç¤º
        function updateDisplay() {
            const data = loadData();
            const today = new Date().toISOString().split('T')[0];
            const todayRecord = data.records.find(r => r.date === today);
            
            const weightInput = document.getElementById('weight-input');
            const bmiDisplay = document.getElementById('bmi-display');
            const bmiCategory = document.getElementById('bmi-category');
            const currentWeight = document.getElementById('current-weight');
            const targetWeight = document.getElementById('target-weight');
            const progressFill = document.getElementById('progress-fill');
            
            targetWeight.textContent = data.targetWeight;
            document.getElementById('height-setting').value = data.height;
            document.getElementById('target-setting').value = data.targetWeight;
            
            if (todayRecord) {
                weightInput.value = todayRecord.weight;
                const bmi = calculateBMI(todayRecord.weight, data.height);
                const result = getBMICategory(bmi);
                bmiDisplay.textContent = bmi;
                bmiCategory.textContent = result.category;
                bmiCategory.style.background = result.color;
                currentWeight.textContent = todayRecord.weight;
            } else if (data.records.length > 0) {
                const latest = data.records[data.records.length - 1];
                const bmi = calculateBMI(latest.weight, data.height);
                const result = getBMICategory(bmi);
                bmiDisplay.textContent = bmi;
                bmiCategory.textContent = result.category;
                bmiCategory.style.background = result.color;
                currentWeight.textContent = latest.weight;
                weightInput.value = latest.weight;
            } else {
                bmiDisplay.textContent = '--';
                bmiCategory.textContent = 'è¯·è®°å½•ä½“é‡';
                currentWeight.textContent = '--';
            }
            
            // è¿›åº¦æ¡
            if (data.records.length > 0) {
                const current = todayRecord ? todayRecord.weight : data.records[data.records.length - 1].weight;
                const start = data.records[0].weight;
                const target = data.targetWeight;
                const totalToLose = start - target;
                const lost = start - current;
                const progress = totalToLose > 0 ? Math.min(100, Math.max(0, (lost / totalToLose) * 100)) : 0;
                progressFill.style.width = progress + '%';
            }
            
            // å®æ—¶è®¡ç®—BMI
            weightInput.oninput = function() {
                if (this.value) {
                    const bmi = calculateBMI(parseFloat(this.value), data.height);
                    const result = getBMICategory(bmi);
                    bmiDisplay.textContent = bmi;
                    bmiCategory.textContent = result.category;
                    bmiCategory.style.background = result.color;
                }
            };
        }
        
        // è®°å½•ä½“é‡
        async function saveWeight() {
            const weight = parseFloat(document.getElementById('weight-input').value);
            
            if (!weight || weight < 20 || weight > 300) {
                showToast('è¯·è¾“å…¥æœ‰æ•ˆä½“é‡', 'error');
                return;
            }
            
            const data = loadData();
            const today = new Date().toISOString().split('T')[0];
            
            const existingIndex = data.records.findIndex(r => r.date === today);
            if (existingIndex >= 0) {
                data.records[existingIndex].weight = weight;
            } else {
                data.records.push({ date: today, weight: weight });
            }
            
            data.records.sort((a, b) => new Date(a.date) - new Date(b.date));
            saveData(data);
            
            showToast('âœ… ä½“é‡å·²è®°å½•ï¼ç‚¹å‡»"åŒæ­¥æ•°æ®"ä¿å­˜åˆ°äº‘ç«¯', 'success');
            updateDisplay();
            
            // è‡ªåŠ¨å°è¯•åŒæ­¥
            try {
                await saveCloudData(data);
                document.getElementById('sync-status').textContent = 'âœ… å·²è‡ªåŠ¨åŒæ­¥åˆ°äº‘ç«¯';
                document.getElementById('sync-status').classList.add('synced');
            } catch (e) {
                console.log('Auto sync failed:', e);
            }
        }
        
        // æ›´æ–°å†å²è®°å½•
        function updateHistory() {
            const data = loadData();
            const list = document.getElementById('records-list');
            
            if (data.records.length === 0) {
                list.innerHTML = '<div class="empty-state">æš‚æ— è®°å½•</div>';
                return;
            }
            
            const recent = data.records.slice(-10).reverse();
            list.innerHTML = recent.map(r => `
                <div class="record-item">
                    <span class="record-date">${r.date}</span>
                    <span class="record-weight">${r.weight}kg</span>
                </div>
            `).join('');
            
            const weights = data.records.map(r => r.weight);
            document.getElementById('stat-count').textContent = weights.length;
            document.getElementById('stat-avg').textContent = weights.length > 0 ? (weights.reduce((a, b) => a + b, 0) / weights.length).toFixed(1) : '--';
            document.getElementById('stat-min').textContent = weights.length > 0 ? Math.min(...weights).toFixed(1) : '--';
            document.getElementById('stat-max').textContent = weights.length > 0 ? Math.max(...weights).toFixed(1) : '--';
        }
        
        // æ›´æ–°æ–¹æ¡ˆ
        function updatePlan() {
            const data = loadData();
            let bmi = 0;
            
            if (data.records.length > 0) {
                const latest = data.records[data.records.length - 1];
                bmi = calculateBMI(latest.weight, data.height);
            }
            
            const plan = getPlan(bmi || 26, data.height);
            const planContent = document.getElementById('plan-content');
            
            planContent.innerHTML = `
                <div style="margin-bottom: 20px;">
                    <strong>ç›®æ ‡:</strong> ${plan.target} | <strong>å‘¨æœŸ:</strong> ${plan.duration}
                </div>
                <h4 style="margin: 16px 0 12px;">ğŸ½ï¸ é¥®é£Ÿå»ºè®®</h4>
                ${plan.diet.map(d => `
                    <div class="plan-item">
                        <div class="plan-icon" style="background: #fff3e0;">ğŸ½ï¸</div>
                        <div class="plan-text">${d}</div>
                    </div>
                `).join('')}
                <h4 style="margin: 16px 0 12px;">ğŸƒ è¿åŠ¨å»ºè®®</h4>
                ${plan.exercise.map(e => `
                    <div class="plan-item">
                        <div class="plan-icon" style="background: #e3f2fd;">ğŸƒ</div>
                        <div class="plan-text">${e}</div>
                    </div>
                `).join('')}
                <h4 style="margin: 16px 0 12px;">ğŸ’¡ å°è´´å£«</h4>
                ${plan.tips.map(t => `
                    <div class="plan-item">
                        <div class="plan-icon" style="background: #f3e5f5;">ğŸ’¡</div>
                        <div class="plan-text">${t}</div>
                    </div>
                `).join('')}
            `;
        }
        
        // ä¿å­˜è®¾ç½®
        function saveSettings() {
            const data = loadData();
            data.height = parseInt(document.getElementById('height-setting').value) || 170;
            data.targetWeight = parseFloat(document.getElementById('target-setting').value) || 65;
            saveData(data);
            showToast('è®¾ç½®å·²ä¿å­˜', 'success');
            updateDisplay();
        }
        
        // æ¸…é™¤æ•°æ®
        function clearData() {
            if (confirm('ç¡®å®šè¦æ¸…é™¤æ‰€æœ‰æ•°æ®å—ï¼Ÿ')) {
                localStorage.removeItem('weightData');
                saveData(DEFAULT_DATA);
                showToast('æ•°æ®å·²æ¸…é™¤', 'success');
                updateDisplay();
            }
        }
        
        // åˆå§‹åŒ–
        async function init() {
            // å°è¯•åŠ è½½äº‘ç«¯æ•°æ®
            try {
                const cloud = await loadCloudData();
                if (cloud) {
                    // åˆå¹¶äº‘ç«¯æ•°æ®åˆ°æœ¬åœ°
                    const local = loadData();
                    if (local.records.length === 0 && cloud.records.length > 0) {
                        saveData(cloud);
                        showToast('âœ… å·²ä»äº‘ç«¯åŒæ­¥æ•°æ®', 'success');
                    }
                }
            } catch (e) {
                console.log('Init sync skipped');
            }
            
            updateDisplay();
        }
        
        init();
    </script>
</body>
</html>
